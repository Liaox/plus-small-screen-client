(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"7FPn":function(t,e,n){},"8LwP":function(t,e,n){"use strict";var s=n("TulX"),i=n.n(s);i.a},CjFX:function(t,e,n){"use strict";var s=n("7FPn"),i=n.n(s);i.a},EmP9:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-news-search"},[n("header",{staticClass:"m-box m-aln-center m-pos-f m-main m-bb1 m-head-top"},[n("div",{staticClass:"m-box m-flex-grow2 m-flex-shrink2 m-aln-center m-head-top-title"},[n("div",{staticClass:"m-search-box"},[n("form",{attrs:{action:"#",onsubmit:"return false"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.keywordOrigin,expression:"keywordOrigin"}],attrs:{type:"search",placeholder:"搜索"},domProps:{value:t.keywordOrigin},on:{input:[function(e){e.target.composing||(t.keywordOrigin=e.target.value)},t.searchNewsByKey]}})])])]),n("div",{staticClass:"m-box m-flex-grow0 m-flex-shrink0 m-aln-center m-justify-end"},[n("a",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.goBack(e)}}},[t._v("取消")])])]),n("jo-load-more",{ref:"loadmore",staticStyle:{"padding-top":"0.9rem"},attrs:{"auto-load":!1,"show-bottom":t.list.length>0},on:{onLoadMore:t.onLoadMore}},t._l(t.list,function(e){return e.id?n("news-item",{key:e.id,attrs:{news:e}}):t._e()})),n("p",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"load-more-ph m-text-c mt10"},[t._v("正在搜索...")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.noResult&&!t.loading&&t.keyword&&!t.list.length,expression:"noResult && !loading && keyword && !list.length"}],staticClass:"placeholder m-no-find"})],1)},i=[],a=n("iv4g"),o=n("LvDl"),r=n.n(o),c=n("aeuq"),l=n("qiqU"),m=n("TsPW"),h={name:"NewsSearch",components:{NewsItem:c["a"]},data:function(){return{keywordOrigin:"",list:[],loading:!1,noResult:!1}},computed:{after:function(){var t=this.list.length;return t>0?this.list[t-1].id:0},keyword:function(){return this.keywordOrigin.trim()}},methods:{searchNewsByKey:r.a.debounce(function(){var t=this;this.keyword&&(this.loading=!0,Object(l["l"])(this.keyword).then(function(e){var n=e.data;t.loading=!1,t.list=n,t.$refs.loadmore.afterRefresh(n.length<m["c"]),n.length||(t.noResult=!0)}))},600),onLoadMore:function(){var t=this;Object(l["l"])(this.keyword,m["c"],this.after).then(function(e){var n=e.data;t.list=Object(a["a"])(t.list).concat(Object(a["a"])(n)),t.$refs.loadmore.afterLoadmore(n.length<m["c"])})}}},u=h,d=(n("hPYw"),n("nsqh"),n("KHd+")),f=Object(d["a"])(u,s,i,!1,null,"8c3f23e6",null);e["default"]=f.exports},EuBo:function(t,e,n){},INYr:function(t,e,n){"use strict";var s=n("XKFU"),i=n("CkkT")(6),a="findIndex",o=!0;a in[]&&Array(1)[a](function(){o=!1}),s(s.P+s.F*o,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),n("nGyu")(a)},RDt0:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-news"},[n("header",{staticClass:"m-box m-pos-f m-main m-bb1 m-head-top"},[n("div",{staticClass:"m-box m-aln-center m-flex-grow1 m-flex-base0"},[n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:t.goBack}},[n("use",{attrs:{"xmlns:xlink":"http://www.w3.org/1999/xlink","xlink:href":"#base-back"}})])]),t._m(0),n("div",{staticClass:"m-box m-aln-center m-flex-grow1 m-flex-base0 m-justify-end"},[n("router-link",{staticClass:"m-style-svg m-svg-def",attrs:{append:"",tag:"svg",to:"search"}},[n("use",{attrs:{"xmlns:xlink":"http://www.w3.org/1999/xlink","xlink:href":"#base-search"}})])],1)]),n("news-filter",{on:{change:t.onCateChange}}),n("load-more",{ref:"loadmore",staticClass:"p-news--body",attrs:{"on-refresh":t.onRefresh,"on-load-more":t.onLoadMore}},t._l(t.list,function(e){return e.id?n("news-item",{key:e.id,attrs:{"current-cate":t.currentCate,news:e}}):t._e()}))],1)},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-box m-aln-center m-flex-grow1 m-flex-base0 m-justify-center m-head-top-title"},[n("span",[t._v("资讯")])])}],a=n("iv4g"),o=n("aeuq"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:[t.prefixCls,{showAll:t.showAll}]},[n("div",{class:t.prefixCls+"--head"},[n("span",[t._v("点击以编辑")]),n("div",[n("button",{on:{click:t.onOk}},[t._v(t._s(t.editing?"完成":"编辑"))]),n("button",{on:{click:t.showEditor}},[t._v("收起")])])]),n("div",{class:t.prefixCls+"--list__wrap"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.showAll,expression:"!showAll"}],class:t.prefixCls+"--switch",on:{click:t.showEditor}},[n("svg",[n("use",{attrs:{"xmlns:xlink":"http://www.w3.org/1999/xlink","xlink:href":"#base-arrow-r"}})])]),n("span",{class:t.prefixCls+"--list__label"},[t._v("我的订阅")]),n("div",{class:[t.prefixCls+"--list",{editing:t.editing}]},[n("div",{class:[t.prefixCls+"--list__item",{active:0===~~t.currentCate.id}],on:{click:function(e){t.chooseCate(e,{id:0,name:"推荐"})}}},[t._v("推荐")]),t._l(t.myCates,function(e){return n("div",{key:"myCate-"+e.id,class:[t.prefixCls+"--list__item",{active:e.id===t.currentCate.id}],on:{click:function(n){t.chooseCate(n,e)}}},[t._v(t._s(e.name))])})],2)]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showAll,expression:"showAll"}],class:t.prefixCls+"--list__wrap"},[n("span",{class:t.prefixCls+"--list__label"},[t._v("更多订阅")]),n("div",{class:t.prefixCls+"--list"},t._l(t.moreCates,function(e){return n("div",{key:"moreCate-"+e.id,class:[t.prefixCls+"--list__item"],on:{click:function(n){t.chooseCate(n,e)}}},[t._v(t._s(e.name))])}))])])},c=[],l=(n("ls82"),n("MECJ")),m=n("yT7P"),h=(n("INYr"),"news__filter"),u={name:"NewsFilter",data:function(){return{prefixCls:h,editing:!1,showAll:!1,myCates:[],moreCates:[],currentCate:{id:0,name:"推荐"}}},watch:{editing:function(){},showAll:function(t){!t&&(this.editing=!1)}},mounted:function(){this.fetchCates()},methods:{showEditor:function(){this.showAll=!this.showAll},onOk:function(){if(this.editing){this.editing=!1;var t=this.myCates.map(function(t){return t.id}).join(",");this.$http.patch("/news/categories/follows",{follows:t}),this.showAll=!1,this.$emit("onOk",this.myCates)}else this.editing=!0},chooseCate:function(t,e){if(this.showAll)if(this.editing){var n=this.myCates.findIndex(function(t){return t.id===e.id});if(n>-1)this.moreCates.push(e),this.myCates.splice(n,1);else{var s=this.moreCates.findIndex(function(t){return t.id===e.id});this.myCates.push(e),this.moreCates.splice(s,1)}}else this.editing=!0;else if(e.id!==this.currentCate.id){var i=t.target;this.currentCate=Object(m["a"])({},e,{el:i}),this.$emit("change",this.currentCate)}},fetchCates:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(){var e,n,s,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get("/news/cates");case 2:e=t.sent,n=e.data,n=void 0===n?{}:n,s=n.my_cates,i=n.more_cates,this.myCates=s?Object(a["a"])(s):[],this.moreCates=i?Object(a["a"])(i):[];case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},d=u,f=(n("cosh"),n("KHd+")),w=Object(f["a"])(d,r,c,!1,null,"4dee4531",null),v=w.exports,p={name:"NewsList",components:{NewsItem:o["a"],NewsFilter:v},data:function(){return{list:[],currentCate:0}},computed:{after:function(){var t=this.list.length;return t>0?this.list[t-1].id:0}},methods:{onCateChange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,n=void 0===e?0:e;this.list=[],this.currentCate=n,this.$refs.loadmore.beforeRefresh()},onRefresh:function(){var t=this,e=0===this.currentCate?{limit:10,recommend:1}:{limit:10,cate_id:this.currentCate};this.$http.get("/news",{params:e}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.data,s=void 0===n?[]:n;t.list=s,t.$refs.loadmore.topEnd(!(s.length<10))})},onLoadMore:function(){var t=this,e=0===this.currentCate?{limit:10,recommend:1,after:this.after}:{limit:10,cate_id:this.currentCate,after:this.after};this.$http.get("/news",{params:e}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.data,s=void 0===n?[]:n;t.list=Object(a["a"])(t.list).concat(Object(a["a"])(s)),t.$refs.loadmore.bottomEnd(s.length<10)})}}},g=p,C=(n("8LwP"),Object(f["a"])(g,s,i,!1,null,"4a4b361e",null));e["default"]=C.exports},TulX:function(t,e,n){},cosh:function(t,e,n){"use strict";var s=n("nils"),i=n.n(s);i.a},hPYw:function(t,e,n){"use strict";var s=n("s3yk"),i=n.n(s);i.a},ixmb:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("article-card",{attrs:{liked:t.liked,loading:t.loading,"can-oprate":0===t.news.audit_status},on:{"on-like":t.likeNews,"on-share":t.shareNews,"on-more":t.moreAction,"on-comment":t.commentNews}},[n("header",{staticClass:"m-box m-justify-bet m-aln-center m-art-head",staticStyle:{padding:"0"},attrs:{slot:"head"},slot:"head"},[n("div",{staticClass:"m-box m-flex-grow1 m-aln-center m-flex-base0"},[n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:t.goBack}},[n("use",{attrs:{"xmlns:xlink":"http://www.w3.org/1999/xlink","xlink:href":"#base-back"}})])]),n("div",{staticClass:"m-box m-flex-grow1 m-aln-center m-flex-base0 m-head-top-title m-text-cut"},[t._v("\n      资讯详情\n    ")]),n("div",{staticClass:"m-box m-flex-grow1 m-aln-center m-flex-base0 m-justify-end"})]),n("jo-load-more",{ref:"loadmore",attrs:{"auto-load":!1},on:{onRefresh:t.onRefresh}},[n("div",{staticClass:"m-flex-shrink1 m-flex-grow1 m-art m-main"},[n("section",{staticClass:"m-art-head"},[n("h1",[t._v(t._s(t.news.title))]),n("p",[n("i",{staticClass:"m-art-cate"},[t._v(t._s(t.cate))]),n("span",[t._v("来自 "+t._s(t.news.from||"原创"))])])]),t.news.subject?n("p",{staticClass:"m-art-subject"},[t._v(t._s(t.news.subject))]):t._e(),n("div",{staticClass:"m-art-body",domProps:{innerHTML:t._s(t.body)}}),n("div",{staticClass:"m-box m-aln-center m-justify-bet m-art-foot"},[n("div",{staticClass:"m-flex-grow1 m-flex-shrink1 m-box m-aln-center m-art-like-list"},[t.likeCount>0&&0===t.news.audit_status?[n("ul",{staticClass:"m-box m-flex-grow0 m-flex-shrink0"},t._l(t.likes.slice(0,5),function(t,e){var s=t.user,i=t.id;return n("li",{key:i,staticClass:"m-avatar-box tiny",style:{zIndex:5-e}},[n("img",{attrs:{src:s.avatar}})])})),n("span",[t._v(t._s(t._f("formatNum")(t.likeCount))+"人点赞")])]:t._e()],2),n("div",{staticClass:"m-box-model m-aln-end m-art-info"},[n("span",[t._v("发布于"+t._s(t._f("time2tips")(t.time)))]),n("span",[t._v(t._s(t._f("formatNum")(t.news.hits||0))+"浏览")])])]),n("div",{staticClass:"m-box-model m-box-center m-box-center-a m-art-reward"},[n("button",{staticClass:"m-art-rew-btn",on:{click:t.rewardNews}},[t._v("打 赏")]),n("p",{staticClass:"m-art-rew-label"},[n("a",{attrs:{href:"javascript:;"}},[t._v(t._s(t._f("formatNum")(t.reward.count)))]),t._v("人打赏，共\n          "),n("a",{attrs:{href:"javascript:;"}},[t._v(t._s(t._f("formatNum")(~~t.reward.amount)))]),t._v("积分\n        ")]),n("router-link",{staticClass:"m-box m-aln-center m-art-rew-list",attrs:{tag:"ul",to:"rewarders",append:""}},[t._l(t.rewardList,function(t){return n("li",{key:t.id,staticClass:"m-flex-grow0 m-flex-shrink0 m-art-rew m-avatar-box tiny",class:"m-avatar-box-"+t.user.sex},[n("img",{attrs:{src:t.user.avatar}})])}),t.rewardList.length>0?n("li",{staticClass:"m-box m-aln-center"},[n("svg",{staticClass:"m-style-svg m-svg-def",staticStyle:{fill:"#bfbfbf"}},[n("use",{attrs:{"xmlns:xlink":"http://www.w3.org/1999/xlink","xlink:href":"#base-arrow-r"}})])]):t._e()],2)],1)]),n("div",{staticClass:"m-box-model m-art-comments"},[n("ul",{staticClass:"m-box m-aln-center m-art-comments-tabs"},[n("li",[t._v(t._s(t._f("formatNum")(t.commentCount))+"条评论")])]),0===t.news.audit_status?[t._l(t.pinnedCom,function(e){return n("comment-item",{key:"pinned-"+e.id,attrs:{comment:e,pinned:!0},on:{click:t.replyComment}})}),t._l(t.comments,function(e){return n("comment-item",{key:"comment-"+e.id,attrs:{comment:e},on:{click:t.replyComment}})}),n("div",{staticClass:"m-box m-aln-center m-justify-center load-more-box"},[t.noMoreCom?n("span",{staticClass:"load-more-ph"},[t._v("---没有更多---")]):n("span",{staticClass:"load-more-btn",on:{click:function(e){e.stopPropagation(),t.fetchNewsComments(t.maxComId)}}},[t._v("\n            "+t._s(t.fetchComing?"加载中...":"点击加载更多")+"\n          ")])])]:t._e()],2)])],1)},i=[],a=n("iv4g"),o=(n("f3/d"),n("rGqo"),n("yt8O"),n("RW0V"),n("yT7P")),r=n("9e9m"),c=n("L2JU"),l=n("YH7M"),m=n("rmEv"),h=n("Ejg1"),u=n("EDhF"),d=n("TsPW"),f=n("qiqU"),w=function(){},v={name:"NewsDetail",components:{ArticleCard:l["a"],CommentItem:m["a"]},data:function(){return{oldID:0,news:{},loading:!0,fetching:!1,likes:[],comments:[],rewardList:[],reward:{count:0,amount:0},pinnedCom:[],fetchComing:!1,noMoreCom:!1,maxComId:0,config:{appid:"",signature:"",timestamp:"",noncestr:""},appList:["onMenuShareQZone","onMenuShareQQ","onMenuShareAppMessage","onMenuShareTimeline"],share:{title:"",desc:"",link:""}}},computed:Object(o["a"])({},Object(c["d"])(["CURRENTUSER"]),{firstImage:function(){var t=this.news.image;return Object.keys(t).length?this.$http.defaults.baseURL+"/files/"+t.id+"?w=300&h=300":""},newsID:function(){return this.$route.params.newsID},userID:function(){return this.news.user_id||0},isMine:function(){return this.news.user_id===this.CURRENTUSER.id},liked:{get:function(){return!!this.news.has_like},set:function(t){this.news.has_like=t}},likeCount:{get:function(){return this.news.digg_count||0},set:function(t){t&&(this.news.digg_count=t)}},commentCount:{get:function(){return this.news.comment_count||0},set:function(t){this.news.comment_count=t}},time:function(){return this.news.created_at||""},cate:function(){var t=this.news.category;t=void 0===t?{}:t;var e=t.name,n=void 0===e?"未分类":e;return n},body:function(){return Object(u["default"])(this.news.content||"")},isWechat:function(){return this.$store.state.BROWSER.isWechat}}),activated:function(){var t=this;this.newsID&&(this.newsID!==this.oldID?this.fetchNews():setTimeout(function(){t.loading=!1},600))},deactivated:function(){this.loading=!0},methods:{shareSuccess:function(){this.$Message.success("分享成功")},shareCancel:function(){this.$Message.success("取消分享")},fetchNews:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;this.fetching||(this.fetching=!0,f["e"](this.newsID).then(function(n){var s=n.data,i=void 0===s?{}:s;if(t.loading=!1,t.fetching=!1,t.news=i,t.oldID=t.newsID,t.share.title=i.title,t.share.desc=i.subject,t.fetchNewsComments(),t.fetchNewsLikes(),t.fetchRewardInfo(),t.fetchRewards(),e(),t.isWechat){var a=window.location.origin+"/plus-small-screen-client/".substr(0,"/plus-small-screen-client/".length-1)+t.$route.fullPath,o="IOS"===t.$store.state.BROWSER.OS?window.initUrl:a;Object(h["a"])(o,{title:i.title,desc:i.subject,link:a,imgUrl:t.firstImage})}}).catch(function(e){console.warn(e),t.$router.back()}))},fetchNewsLikes:function(){var t=this;this.$http.get("/news/".concat(this.newsID,"/likes")).then(function(e){var n=e.data,s=void 0===n?[]:n;s&&s.length,t.likes=s})},fetchNewsComments:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fetchComing||(this.fetchComing=!0,f["g"](this.newsID,{after:e}).then(function(n){var s=n.data,i=s.pinneds,o=void 0===i?[]:i,r=s.comments,c=void 0===r?[]:r;if(e)t.comments=Object(a["a"])(t.comments).concat(Object(a["a"])(c));else{t.pinnedCom=o;var l=o.map(function(t){return t.id});t.comments=c.filter(function(t){return l.indexOf(t.id)<0})}c.length&&(t.maxComId=c[c.length-1].id),t.noMoreCom=c.lenght!==d["c"],t.fetchComing=!1}).catch(function(){t.fetchComing=!1}))},fetchRewards:function(){var t=this;f["h"](this.newsID,{limit:10}).then(function(e){var n=e.data,s=void 0===n?{}:n;t.rewardList=s})},fetchRewardInfo:function(){var t=this;f["i"](this.newsID).then(function(e){var n=e.data,s=void 0===n?{}:n;t.reward={count:~~s.count||0,amount:~~s.amount||0}})},rewardNews:function(){var t=this,e=function(e){t.fetchRewards(),t.reward.count+=1,t.reward.amount+=e};r["a"].$emit("reward",{type:"news",api:f["k"],payload:this.newsID,callback:e})},likeNews:function(){var t=this,e=this.liked?"delete":"post";this.fetching||(this.fetching=!0,this.$http({method:e,url:"/news/".concat(this.newsID,"/likes"),validateStatus:function(t){return 201===t||204===t}}).then(function(){"post"===e?(t.liked=!0,t.likeCount+=1):(t.liked=!1,t.likeCount-=1),t.fetching=!1}).catch(function(){t.fetching=!1}))},commentNews:function(){var t=this;r["a"].$emit("commentInput",{onOk:function(e){t.sendComment({body:e})}})},shareNews:function(){},moreAction:function(){var t=this,e=[{text:"收藏",method:function(){}}],n=this.isMine?[{text:"申请文章置顶",method:function(){r["a"].$emit("applyTop",{type:"news",api:f["a"],payload:t.newsID})}},{text:"删除",method:function(){t.$Message.info("资讯删除功能开发中，敬请期待")}}]:[{text:"举报",method:function(){t.$Message.info("举报功能开发中，敬请期待")}}];r["a"].$emit("actionSheet",e.concat(n),"取消")},replyComment:function(t,e,n){var s=this;if(t===this.CURRENTUSER.id){var i=t===this.userID,a=[{text:i?"评论置顶":"申请评论置顶",method:function(){r["a"].$emit("applyTop",{isOwner:i,type:"newsComment",api:f["b"],payload:{newsId:s.newsID,commentId:n},callback:s.fetchNewsComments})}},{text:"删除评论",method:function(){return s.deleteComment(n)}}];r["a"].$emit("actionSheet",a,"取消")}else r["a"].$emit("commentInput",{placeholder:"回复： ".concat(e),onOk:function(e){s.sendComment({reply_user:t,body:e})}})},sendComment:function(t){var e=this,n=t.reply_user,s=t.body,i={};s&&s.length>0?(i.body=s,n&&(i["reply_user"]=n),this.$http.post("/news/".concat(this.newsID,"/comments"),i,{validateStatus:function(t){return 201===t}}).then(function(){e.$Message.success("评论成功"),e.fetchNewsComments(),e.commentCount+=1,r["a"].$emit("commentInput:close",!0)}).catch(function(){e.$Message.error("评论失败"),r["a"].$emit("commentInput:close",!0)})):this.$Message.error("评论内容不能为空")},deleteComment:function(t){var e=this;f["c"](this.newsID,t).then(function(){e.fetchNewsComments(),e.commentCount-=1,e.$Message.success("删除评论成功")})},onRefresh:function(){var t=this;this.fetchNews(function(){t.$refs.loadmore.afterRefresh(!0)})}}},p=v,g=(n("CjFX"),n("KHd+")),C=Object(g["a"])(p,s,i,!1,null,"db94e7d4",null);e["default"]=C.exports},nils:function(t,e,n){},nsqh:function(t,e,n){"use strict";var s=n("EuBo"),i=n.n(s);i.a},s3yk:function(t,e,n){}}]);
//# sourceMappingURL=news-de1be733d132b711b615.js.map